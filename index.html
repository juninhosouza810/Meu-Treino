<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Meu Treino</title>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #1f1c2c, #928dab);
      color: #fff;
      margin: 0;
      padding: 0;
      display: flex;
      justify-content: center;
      align-items: flex-start;
      min-height: 100vh;
    }

    .container {
      width: 100%;
      max-width: 480px;
      margin: 30px auto;
      padding: 25px;
      background: rgba(0, 0, 0, 0.85);
      border-radius: 15px;
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.4);
      display: flex;
      flex-direction: column;
      gap: 20px;
    }

    .cabecalho img {
      display: block;
      height: 100px;
      margin: 0 auto;
    }

    h3 {
      color: #fcb045;
      margin: 0;
    }

    iframe {
      width: 100%;
      border-radius: 10px;
      min-height: 80px;
    }

    .spotify-section {
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .input-field {
      display: flex;
      align-items: center;
      background: #333;
      padding: 12px;
      border-radius: 10px;
      gap: 10px;
    }

    .input-field input {
      flex: 1;
      background: transparent;
      border: none;
      color: #fff;
      font-size: 1rem;
      outline: none;
    }

    .trash-icon {
      color: #f44336;
      cursor: pointer;
      font-size: 1.3rem;
    }

    #days-container {
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .day-button {
      width: 100%;
      background: linear-gradient(90deg, #f7971e, #ffd200);
      border: none;
      padding: 12px;
      border-radius: 10px;
      font-weight: bold;
      font-size: 1.1rem;
      color: #000;
      cursor: pointer;
      transition: transform 0.2s;
    }

    .day-button:hover {
      transform: scale(1.02);
    }

    .pdf-btn {
      background: linear-gradient(90deg, #00c6ff, #0072ff);
      color: #fff;
      border: none;
      padding: 12px;
      border-radius: 10px;
      font-weight: bold;
      width: 100%;
      cursor: pointer;
    }

    #monitor-corrida {
      display: none;
      background: #333;
      padding: 20px;
      border-radius: 12px;
    }

    #monitor-corrida p {
      margin: 8px 0;
    }

    #monitor-corrida button {
      margin-right: 10px;
      padding: 10px 15px;
      border: none;
      border-radius: 8px;
      background: #fcb045;
      font-weight: bold;
      color: #000;
      cursor: pointer;
    }

    .exercise-container {
      display: none;
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: #222;
      padding: 25px;
      border-radius: 15px;
      width: 90%;
      max-width: 400px;
      box-shadow: 0 5px 20px rgba(0, 0, 0, 0.7);
      z-index: 999;
    }

    .exercise-list {
      list-style: none;
      padding: 0;
      margin: 15px 0;
      color: #fff;
    }

    .exercise-list li {
      background: #444;
      padding: 10px;
      border-radius: 6px;
      margin-bottom: 8px;
      display: flex;
      justify-content: space-between;
    }

    .remove-btn {
      background: #f44336;
      border: none;
      color: white;
      padding: 6px 10px;
      border-radius: 6px;
      cursor: pointer;
    }

    .add-btn, .return-btn {
      width: 100%;
      margin-top: 10px;
      padding: 10px;
      border: none;
      border-radius: 10px;
      font-weight: bold;
      cursor: pointer;
    }

    .add-btn {
      background: linear-gradient(90deg, #00b09b, #96c93d);
      color: white;
    }

    .return-btn {
      background: #777;
      color: white;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="cabecalho">
      <img src="https://github.com/user-attachments/assets/9d9a990a-677c-4793-b1d2-f3acc7f83b73" alt="Logo Novo">
    </div>

    <div class="spotify-section">
      <h3>Playlist no Spotify</h3>
      <iframe 
        src="https://open.spotify.com/embed/playlist/37i9dQZF1DX76Wlfdnj7AP?utm_source=generator" 
        frameborder="0"
        allow="autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture"
        loading="lazy">
      </iframe>
    </div>

    <div class="input-field">
      <input type="text" id="nome" placeholder="Nome do Aluno">
      <span class="trash-icon" onclick="apagarNome()">üóëÔ∏è</span>
    </div>

    <div id="days-container"></div>
    <button class="pdf-btn" onclick="gerarPdf()">Gerar PDF</button>

    <div id="monitor-corrida">
      <h3>Monitoramento de Corrida</h3>
      <p><strong>Tempo:</strong> <span id="tempo">0s</span></p>
      <p><strong>Dist√¢ncia:</strong> <span id="distancia">0.00 km</span></p>
      <p><strong>Velocidade:</strong> <span id="velocidade">0.00 km/h</span></p>
      <p><strong>Pace:</strong> <span id="pace">0.00 min/km</span></p>
      <button onclick="iniciarCorrida()">Iniciar</button>
      <button onclick="pararCorrida()">Parar</button>
    </div>
  </div>

  <div id="exercise-modal" class="exercise-container">
    <h2 id="modal-title"></h2>
    <ul class="exercise-list" id="exercise-list"></ul>
    <input type="text" id="exercise-input" class="input-field" placeholder="Novo exerc√≠cio">
    <button class="add-btn" onclick="addExercise()">Adicionar</button>
    <button class="return-btn" onclick="closeModal()">Retornar</button>
  </div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.4.0/jspdf.umd.min.js"></script>
  <script>
    const days = ['Treino A', 'Treino B', 'Treino C', 'Treino D', 'Running'];
    const daysContainer = document.getElementById('days-container');
    let currentDay = '';
    let exercises = JSON.parse(localStorage.getItem('exercises')) || {};

    document.addEventListener('DOMContentLoaded', () => {
      const savedName = localStorage.getItem('nomeAluno');
      if (savedName) document.getElementById('nome').value = savedName;

      days.forEach(day => {
        const button = document.createElement('button');
        button.className = 'day-button';
        button.textContent = `${day} +`;
        button.onclick = () => openModal(day);
        daysContainer.appendChild(button);
      });
    });

    function openModal(day) {
      currentDay = day;

      if (day === 'Running') {
        document.getElementById('exercise-modal').style.display = 'none';
        document.getElementById('monitor-corrida').style.display = 'block';
        return;
      }

      document.getElementById('monitor-corrida').style.display = 'none';
      document.getElementById('modal-title').innerText = `Exerc√≠cios de ${day}`;
      document.getElementById('exercise-modal').style.display = 'block';
      loadExercises();
    }

    // Monitoramento de Corrida com GPS
    let watchId;
    let startTime;
    let totalDistance = 0;
    let lastCoords = null;

    function iniciarCorrida() {
      if (!navigator.geolocation) {
        alert("Geolocaliza√ß√£o n√£o suportada.");
        return;
      }

      startTime = Date.now();
      totalDistance = 0;
      lastCoords = null;

      document.getElementById('tempo').textContent = '0s';
      document.getElementById('distancia').textContent = '0.00 km';
      document.getElementById('velocidade').textContent = '0.00 km/h';
      document.getElementById('pace').textContent = '0.00 min/km';

      watchId = navigator.geolocation.watchPosition(
        (position) => {
          const { latitude, longitude } = position.coords;
          const currentTime = Date.now();
          const elapsedTime = (currentTime - startTime) / 1000;

          if (lastCoords) {
            const distance = calcularDistancia(lastCoords.latitude, lastCoords.longitude, latitude, longitude);
            totalDistance += distance;
          }

          lastCoords = { latitude, longitude };

          const tempoMin = elapsedTime / 60;
          const velocidade = totalDistance / (elapsedTime / 3600);
          const pace = tempoMin / totalDistance;

          document.getElementById('tempo').textContent = `${Math.floor(elapsedTime)}s`;
          document.getElementById('distancia').textContent = `${totalDistance.toFixed(2)} km`;
          document.getElementById('velocidade').textContent = `${velocidade.toFixed(2)} km/h`;
          document.getElementById('pace').textContent = isFinite(pace) ? `${pace.toFixed(2)} min/km` : '0.00 min/km';
        },
        (error) => {
          console.error("Erro:", error);
          alert("Erro na localiza√ß√£o. Verifique as permiss√µes.");
        },
        {
          enableHighAccuracy: true,
          maximumAge: 1000,
          timeout: 5000
        }
      );
    }

    function pararCorrida() {
      if (watchId) {
        navigator.geolocation.clearWatch(watchId);
        watchId = null;
      }
    }

    function calcularDistancia(lat1, lon1, lat2, lon2) {
      const R = 6371;
      const dLat = (lat2 - lat1) * Math.PI / 180;
      const dLon = (lon2 - lon1) * Math.PI / 180;
      const a =
        Math.sin(dLat / 2) * Math.sin(dLat / 2) +
        Math.cos(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) *
        Math.sin(dLon / 2) * Math.sin(dLon / 2);
      const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));
      return R * c;
    }
  </script>
</body>
</html>
